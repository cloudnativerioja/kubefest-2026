---
import Reveal from './Reveal.astro';
import { EVENT_DATE } from '../constants';

const countdownItems = [
  { id: "countdown-days", val: "00", label: "Días" },
  { id: "countdown-hours", val: "00", label: "Horas" },
  { id: "countdown-minutes", val: "00", label: "Min" },
  { id: "countdown-seconds", val: "00", label: "Seg" },
];

// Format the event date as ISO string for JavaScript
const eventDateISO = EVENT_DATE.toISOString();
---

<div class="flex flex-1 justify-center py-5 px-4 md:px-0">
  <div class="flex flex-col max-w-[960px] flex-1 w-full">
    <div class="@container">
      <div class="@[480px]:p-4">
        <div
          class="hero-bg relative flex min-h-[640px] flex-col gap-6 overflow-hidden rounded-xl items-center justify-center p-8 text-center bg-cover bg-center"
          style={{
            backgroundImage:
              'linear-gradient(135deg, rgba(11, 17, 32, 0.85) 0%, rgba(0, 71, 141, 0.7) 100%), url("https://lh3.googleusercontent.com/aida-public/AB6AXuCKorcoiHefL5Q6UNSYq5q8W57dyqvnYXV-sc67R_ZyUL496PcuLiN3wheKVMjf5fLivActR5qN33MX9DnUGsnknOjZPA2aSw84XNnbYfwjynUA9938Xuv0beLLDVz5Uon9m_M-34_wmu5vQ539Hi2ELoGTnrcfeRvtj26eGpstAhvgWGQMRTUgUGmZ9-93wRwSIhgHpcmeaoLswNns_07caBtIlsmQSizBy2Tx5fNB77cbNB1STI5PLvf8bAuUPvSvmLK5tZ66RA")',
          }}
        >
          <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-cncf-blue/20 blur-[120px] rounded-full pointer-events-none animate-pulse-slow"></div>
          <div class="relative flex flex-col gap-4 z-10 max-w-3xl animate-fade-in-up">
            <div class="inline-flex items-center justify-center gap-2 px-4 py-1.5 rounded-full bg-white/10 border border-white/20 backdrop-blur-md w-fit mx-auto shadow-lg">
              <span class="material-symbols-outlined text-sm text-cncf-blue">calendar_today</span>
              <span class="text-xs font-bold uppercase tracking-wider text-white">21 Febrero 2026</span>
              <span class="w-1 h-1 rounded-full bg-white/40 mx-1"></span>
              <span class="material-symbols-outlined text-sm text-secondary">location_on</span>
              <span class="text-xs font-bold uppercase tracking-wider text-white">Logroño, La Rioja</span>
            </div>
            <h1 class="text-white text-5xl font-black leading-tight tracking-[-0.033em] md:text-6xl lg:text-7xl drop-shadow-2xl mt-4">
              Infraestructura, <br />
              <span class="text-transparent bg-clip-text bg-gradient-to-r from-cncf-blue via-[#00a3ff] to-secondary">
                Kubernetes e IA
              </span>
            </h1>
            
            <Reveal mode="children" className="w-full">
              <div class="grid grid-cols-4 gap-3 md:gap-6 w-full max-w-2xl mx-auto my-6 md:my-8" data-event-date={eventDateISO}>
                {countdownItems.map((item) => (
                  <div
                    class="flex flex-col p-3 md:p-4 bg-black/20 backdrop-blur-md rounded-xl border border-white/10 items-center shadow-xl hover:border-cncf-blue/50 transition-colors duration-300"
                  >
                    <span id={item.id} class="text-3xl md:text-5xl font-bold text-white font-display">{item.val}</span>
                    <span class="text-[10px] md:text-xs font-bold text-cncf-blue uppercase tracking-wider mt-1">
                      {item.label}
                    </span>
                  </div>
                ))}
              </div>
            </Reveal>

            <p class="text-gray-200 text-lg font-normal leading-relaxed md:text-xl max-w-lg mx-auto drop-shadow-md">
              Logroño se convierte en el epicentro Cloud Native. Únete a la revolución de la infraestructura inteligente.
            </p>
          </div>
          
          <Reveal delay={0.5} className="relative flex flex-wrap gap-4 justify-center z-10 mt-6">
            <button class="flex min-w-[160px] cursor-pointer items-center justify-center rounded-lg h-12 px-6 bg-cncf-blue hover:bg-cncf-dark transition-all hover:scale-105 hover:-translate-y-1 text-white text-base font-bold shadow-[0_4px_20px_rgba(0,134,255,0.4)]">
              <span class="mr-2">Reservar entrada</span>
              <span class="material-symbols-outlined text-sm">arrow_forward</span>
            </button>
          </Reveal>
        </div>
      </div>
    </div>
  </div>
</div>

<script define:vars={{ eventDateISO }}>
  const eventDate = new Date(eventDateISO);
  
  function updateCountdown() {
    const now = new Date();
    const difference = eventDate.getTime() - now.getTime();
    
    if (difference <= 0) {
      // Event has passed
      const daysEl = document.getElementById('countdown-days');
      const hoursEl = document.getElementById('countdown-hours');
      const minutesEl = document.getElementById('countdown-minutes');
      const secondsEl = document.getElementById('countdown-seconds');
      
      if (daysEl) daysEl.textContent = '00';
      if (hoursEl) hoursEl.textContent = '00';
      if (minutesEl) minutesEl.textContent = '00';
      if (secondsEl) secondsEl.textContent = '00';
      return;
    }
    
    const days = Math.floor(difference / (1000 * 60 * 60 * 24));
    const hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((difference % (1000 * 60)) / 1000);
    
    const daysEl = document.getElementById('countdown-days');
    const hoursEl = document.getElementById('countdown-hours');
    const minutesEl = document.getElementById('countdown-minutes');
    const secondsEl = document.getElementById('countdown-seconds');
    
    if (daysEl) daysEl.textContent = String(days).padStart(2, '0');
    if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
    if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
    if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
  }
  
  // Update immediately
  updateCountdown();
  
  // Update every second
  setInterval(updateCountdown, 1000);
</script>
